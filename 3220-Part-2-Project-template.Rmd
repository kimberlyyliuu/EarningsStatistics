---
title: "Insert heading" 
author: "KHL"
fontsize: 12pt
geometry: margin=1in
urlcolor: black
output: pdf_document
header-includes:
- \usepackage{setspace}
- \usepackage{ulem}
- \usepackage{hyperref}
- \onehalfspacing
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, highlight=FALSE, comment=NA, warnings=FALSE,message=FALSE)
```

```{r, echo=FALSE, warning=FALSE,results=FALSE}
## Use this chunk for reading in packages.
## Use this chunk for reading in the data, combining the data, and any other major data cleaning that is not relevant to show.
## Remove the ## before all code.
incomeData<-read.csv("https://raw.githubusercontent.com/kimberlyyliuu/STAT3220Project/main/completeData")
library(ggplot2)
library(dplyr)
library(ggthemes)
if (!requireNamespace("cowplot", quietly = TRUE)) {
  install.packages("cowplot")
}
library(cowplot)
library(corrplot)
library(olsrr)
library(car)
```

\begin{center}

remove the pound sign and insert the file path to the image on your computer in the {}

\end{center}

\newpage 

## Introduction

The research question(s); Background/significance of the research;
and relevant highlighted information about the data set. (abbreviated version of
part 1)

\begin{itemize}
  \item Does a higher level of educational attainment generally increase personal earnings income across different states?
  \item Does personal earnings increase with an individual's health?
  \item Do older individuals generally earn more money than younger individuals? 
\end{itemize}

Given the rise in inflation and cost of living, exploring the relationships connected to personal earnings across different states is fundamental to understanding how factors like education, health status, and age, influence income disparities at a regional level.This inquiry is grounded in the longstanding debate within economic and social research regarding the return on investment in education, health, and wellness. By examining these relationships across diverse geographical areas, the analysis can uncover nuanced insights into how local economies, policies, and opportunities shape the economic benefits of educational attainment. 

The U.S. Census is pivotal in the nation's political and economic framework, ensuring each community receives its fair share based on its specific needs (Bureau, 2021).

In addition, it is crucial to the political sphere with its use in redrawing a multitude of political boundaries to ensure each district contains roughly equal numbers of people (Mather & Scommegna, 2019). Its political importance extends even to the U.S. House of Representatives, which bases its apportionment of House seats on Census population data, safeguarding the equity of voting power within the nation (Farley, 2020). 


Originating from multiple reputable sources, the dataset focuses on the United States demographic, economic, and educational landscapes as of 2020. It's based on the US Census Bureau's Annual Social and Economic Supplement (ASEC) survey, including the Current Population Survey (CPS) for employment statistics, and adds questions on poverty and migration. Unemployment data comes from the Bureau of Labor Statistics, and urban population percentages from the Census Bureau's Decennial Census. State sales tax rates, sourced from the Tax Foundation, provide a financial perspective.

The dataset was merged on a state basis, focusing on individuals 18 and older to better represent the adult population. It includes averages of education level, gender, work expenses, and age from the ASEC survey, combined with unemployment rates from the Bureau of Labor Statistics and sales tax rates from the Tax Foundation at the state level. 

## Methods and Analysis

Include EDA from Report 1 

ANALYSIS: 
- Multiple linear regression logistic regression 
- Include required analysis steps
• Include the ”added techniques” that you selected
• Assessing the model.
• Selecting a final ”best” model.
• NOTE: Your analysis should follow the appropriate order on your poster with a
logical flow

Model building with significance testing (should be supported by EDA and/or variable
screening)
• Identify and check for multicollinearity
• Residual analysis (assumptions + extreme observations) Make necessary adjustments as
you see fit. If you are attempting to correct a violation, you only need to try up to three
corrections, if the first doesn’t work. Include plots or output as needed.
• Final model selected should be assessed. It may not be great, but you will explain that in
conclusion
• Include at least ONE additional techniques from the list to add to your analysis:
Weighted least squares (Ch 9.4), External Model validation (Ch 5.11), box -cox
transformation (supplemental), or another technique or aspect of MLR you learned on
your own.
• NOTE: if you have a unique situation with your data- discuss your analysis plan with Prof
Varanyak

```{r, results=F}
## From the EDA, we saw that the level "Bachelors" for H_ED only had one response. It also had significantly higher PEARNVAL than any other response. To prevent extrapolation and excessive skew, we should remove this from the data, especially if we are going to use H_ED as a predictor in the model
#Displaying unequal responses to levels: 
incomeData |>
  group_by(H_ED) |>
  summarise(count=n())
#Subsetting out DC: 
incomeData<-incomeData |>
  filter(STATEFIPS != 11)

##EDA to explore variables in relation to the response, PEARNVAL
#Scatter plots for quantitative:
plot(incomeData$AGE,incomeData$PEARNVAL)
plot(incomeData$UNEMP_RATE,incomeData$PEARNVAL)
plot(incomeData$TAX_RTE,incomeData$PEARNVAL)
plot(incomeData$URB_PER,incomeData$PEARNVAL)
plot(incomeData$WRK_SPND,incomeData$PEARNVAL)

#Boxplots for qualitative:
boxplot(PEARNVAL~H_ED,data=incomeData)
boxplot(PEARNVAL~SEX,data=incomeData)
boxplot(PEARNVAL~HEA,data=incomeData)

##Model with all predictors: 
incomemod1<-lm(PEARNVAL~AGE+UNEMP_RATE+TAX_RTE+URB_PER+WRK_SPND+HEA+SEX+H_ED,data=incomeData)
summary(incomemod1)
#Results in a globally significant model

##Checking first model for influential observations:
influencePlot(incomemod1)
#Using the Studentized residual threshold of an absolute value of 2, there are 2 outliers, corresponding to observations 9 and 11.

residualPlots(incomemod1,tests=F)
#Looking at residual plot, there appears to be a fanning relationship with residuals for UNEMP_RATE and potentially WRK_SPND

plot(incomemod1,which=2)
#QQplot is approximately linear

hist(residuals(incomemod1))
#residuals are approximately normally distributed

##Checking for multicollinearity
cor(incomeData[7:11])
quantincomeData<-incomeData[7:11]
corrplot(cor(quantincomeData))
#No significant multicollinearity between quantitative variables

##Building a model using step wise regression
ols_step_both_p(incomemod1,pent=0.15,prem=0.15,details=T)
incomemod2<-lm(PEARNVAL~H_ED+URB_PER,data=incomeData)
summary(incomemod2)
#Results in a globally significant model

##Checking second model for influential observations:
influencePlot(incomemod2)
#Again, two influential observations (11 and 21)

residualPlots(incomemod2,tests=F)
#No problems with residuals

plot(incomemod2,which=2)
#Approximate linearity, but worse than first model

hist(residuals(incomemod2))
#Residuals approximately normal, but distribution worse (less normal) than first model

##Building a third model with our 3 important var from part I of the project:
incomemod3<-lm(PEARNVAL~H_ED+HEA+AGE,data=incomeData)
summary(incomemod3)
#Globally significant model, but HEA and AGE are individually insignificant
```

## Results
The statistical interpretation of the final model. This should be in
statistical terms and overall interpreting and assessing the statistical usefulness
of the model with the appropriate metrics. There should be no R output (that
will go in the appendix). However, you will include your final model.



## Conclusions
- interpreting your results of the analyses in context of the problem
- commenting on areas of future improvements.


\newpage

## Appendix A: Data Dictionary

| **Reference Name**                     | **Variable Name** | **Description**                                                                                                                                                                                                                                                  |
|------------------------------------------------------------------------------------|------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **State by FIPS Code**                 | `STATEFIPS`       | A qualitative measure that identifies the U.S. state (or D.C.) corresponding to the observation by a standardized numeric code. The 51 possible levels are discrete, ranging from 1-56, omitting 3, 7, 14, 43, and 52.                                           |
| **State**                              | `State`           | A qualitative measure that identifies the state corresponding to the observation. The 51 possible levels are names of the 50 U.S. states and the District of Columbia.                                                                                          |
| **Educational Attainment**             | `H_ED`            | A qualitative measure that identifies the average of highest education among adult residents of a given state. The three possible levels include a Vocational Associate's Degree, an Academic Associate's Degree, and a Bachelor's Degree.                        |
| **Majority Sex**                       | `SEX`             | A qualitative measure that identifies the predominant sex among a state's adult residents. Two possible levels, male and female, indicate if the adult population of a state is predominately male or female.                                                   |
| **Health Status**                      | `HEA`             | A qualitative measure that reports the average health status of a state's residents. Two levels, very good health and good health indicate the average health status of a state's residents.                                                                    |
| **Personal Earnings**                  | `PEARNVAL`        | A continuous quantitative measure that reports the average personal earnings of a state's residents, reported in U.S. Dollars. Possible values within the data range from \$45096.53 to \$95387.40.                                                               |
| **Age**                                | `AGE`             | A continuous quantitative measure that reports the average age of a state's adult residents in years. Values range from 40.83460 to 46.39759.                                                                                                                    |
| **Unemployment Rate**                  | `UNEMP_RATE`      | A continuous quantitative measure of a state's unemployment rate from 2020. Unemployment rate is reported as a percentage; the range of possible values within the data is from 4.2% to 13.5%.                                                                  |
| **Sales Tax Rate**                     | `TAX_RTE`         | A continuous quantitative measure of a state's sales tax. Sales Tax Rate is reported as a numerical figure; the range of possible values within the data is from 0.0% (0% sales tax) to 7.25% (7.25% sales tax).                                                |
| **Percentage of Urban Residents**      | `URB_PER`         | A continuous quantitative measure of a state's proportion of urban residents to nonurban residents. This variable is reported as a percentage; the range of possible values within the data is from 38.7% to 100.0%.                                            |
| **Work Expenses**                      | `WRK_SPND`        | A continuous quantitative measure that identifies the average amount of money spent on work-related expenses among residents of a state, reported in U.S. Dollars. Possible values in the data range from \$1101.676 to \$1463.411.                                |


\newpage
## Appendix B: Data Rows
```{r, echo=FALSE}
# Use head() function to output first several rows
head(incomeData,n=15)
```

\newpage
## Appendix C: Tables and Figures
```{r, echo=FALSE, warning=FALSE,results=FALSE}
## This code chunk can be used to execute any functions or summaries 
## that will not be included in your appendix
##Figures and Tables Final model output and plots. This should only be a
## summary of your final model. This is limited to 3 pages.

```

```{r, echo=FALSE}
## Use this section to output the summary of your final model
## Include the relevant plots from EDA, assumptions, and your additional techniques
## This should NOT be a dump of all of your plots and outputs.
## Refer to the Rmarkdown guide for sizing information on your plots
```

\newpage
## Appendix D: References

### Background
- Bureau, U. C. (2021, November 23). Why we conduct the decennial census of Population and Housing. Census.gov. https://tinyurl.com/5fdyh82c

- Mather, M., & Scommegna, P. (2019, March 15). Why is the U.S. Census so important?. Population Reference Bureau https://www.prb.org/resources/importance-of-u-s-census/ 

- Farley, R. (2020, January 31). The importance of census 2020 and the challenges of getting a complete count. Harvard Data Science Review. https://hdsr.mitpress.mit.edu/pub/rosc6trb/release/3 

### Data
- 2020 Unemployment Rates: U.S. Bureau of Labor Statistics. (2024). Unemployment rates for states. U.S. Bureau of Labor Statistics. https://www.bls.gov/lau/lastrk20.htm 
 
- Urban percentage of the population for states, historical. Urban Percentage of the Population for States, Historical | Iowa Community Indicators Program. (2024.). https://www.icip.iastate.edu/tables/population/urban-pct-states 

- State and local sales tax rates, 2020. Tax Foundation. (2024, February 22). https://taxfoundation.org/data/all/state/2020-sales-taxes/ 

- Bureau, U. C. (2022, October 27). 2020 annual social and economic supplements. Census.gov. https://www.census.gov/data/datasets/2020/demo/cps/cps-asec-2020.html 

- ASEC 2020 Public Use Data Dictionary. (2020). https://tinyurl.com/3h8vexva

### Supplemental Code and Analysis Help
1. List your references used to learn more about your techniques and coding here